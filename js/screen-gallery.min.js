function galleryImage(e){var r={image:e,targetWidth:300/e.find("img").attr("height")*e.find("img").attr("width"),visible:!0,show:function(){jQuery(this.image).show(),this.visible=!0},height:function(e){jQuery(this).attr("height",e)},remove:function(){jQuery(this.image).remove()}};return r}function row(e,r){var i={height:ScreenGallery.maxHeight,sumWidth:r,maxWidth:ScreenGallery.width(),id:null,fit:function(){jQuery(this.id).height(jQuery(this.id).height()*this.maxWidth/this.sumWidth)},remove:function(){jQuery(this.id).remove()}};return i.id="row-"+rows.length,jQuery(".gallery").append("<div id='"+i.id+"' class='gallery-row'></div>"),i.id="#"+i.id,e.forEach(function(e){jQuery(i.id).append(jQuery(e.image)[0].outerHTML)}),jQuery(i.id).height(i.height),i.fit(),i}function insertImageArray(e){e.each(function(){var e=new galleryImage(jQuery(this));galleryImages.push(e)}),placeInRows()}function placeInRows(){rows.forEach(function(e){e.remove()}),rows.length=0;var e=[],r=0;galleryImages.forEach(function(i){r+=i.targetWidth,e.push(i),r>=ScreenGallery.width()&&(rows.push(new row(e,r)),e=[],r=0)}),e.length&&rows.push(new row(e,r)),ScreenGallery.positionWrapper()}function hasGalleryEnded(){isOnScreen(jQuery(".gallery-end"))&&loadMoreImages()}function isOnScreen(e){var r=jQuery(window).height(),i=jQuery(window).scrollTop(),t=jQuery(e).offset().top;return r+i+300>t}function loadMoreImages(){jQuery.ajax({type:"POST",url:ajaxdata.ajaxurl,data:{action:"get_images",offset:offset},success:function(e){var r=jQuery(".gallery-buffer a").length;jQuery(".gallery-buffer").append(e),insertImageArray(jQuery(".gallery-buffer a").slice(r)),offset+=10,"empty"!=e&&hasGalleryEnded()}})}function debouncer(e,r){var i,r=r||200;return function(){var t=this,n=arguments;clearTimeout(i),i=setTimeout(function(){e.apply(t,Array.prototype.slice.call(n))},r)}}var ScreenGallery={maxHeight:jQuery("#maxHeight").html(),input:jQuery("#gallery-tag-search"),wrapper:jQuery(".gallery-wrapper"),init:function(){this.positionWrapper(),this.bindAction()},bindAction:function(){this.input.on("change",function(){ScreenGallery.filterTags()}),jQuery(window).resize(debouncer(function(){placeInRows()})),jQuery(window).scroll(debouncer(function(){hasGalleryEnded()}))},positionWrapper:function(){this.wrapper.parent().height(this.wrapper.height()+50)},filterTags:function(){},width:function(){return this.wrapper.width()}},galleryImages=[],rows=[],offset=10;!function(){ScreenGallery.init(),insertImageArray(jQuery(".gallery-buffer a")),hasGalleryEnded()}();