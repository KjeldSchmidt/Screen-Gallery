function galleryImage(e){var r={image:e,targetWidth:ScreenGallery.maxHeight/e.find("img").attr("height")*e.find("img").attr("width")+20,height:function(e){jQuery(this).attr("height",e)},remove:function(){jQuery(this.image).remove()}};return r}function row(e,r){var i={height:ScreenGallery.maxHeight,sumWidth:r,maxWidth:ScreenGallery.width(),id:null,fit:function(){jQuery(this.id).height(jQuery(this.id).height()*this.maxWidth/this.sumWidth)},remove:function(){jQuery(this.id).remove()}};return i.id="row-"+ScreenGallery.galleryRows.length,jQuery(".gallery").append("<div id='"+i.id+"' class='galleryRow'></div>"),i.id="#"+i.id,e.forEach(function(e){jQuery(i.id).append(jQuery(e.image)[0].outerHTML)}),jQuery(i.id).height(i.height),i.fit(),i}function debouncer(e,r){var i,r=r||200;return function(){var t=this,n=arguments;clearTimeout(i),i=setTimeout(function(){e.apply(t,Array.prototype.slice.call(n))},r)}}function isOnScreen(e){var r=jQuery(window).height(),i=jQuery(window).scrollTop(),t=jQuery(e).offset().top;return r+i+300>t}var ScreenGallery={maxHeight:parseInt(jQuery("#maxHeight").html(),10),input:jQuery("#gallery-tag-search"),wrapper:jQuery(".galleryWrapper"),galleryImages:[],galleryRows:[],offset:10,init:function(){this.positionWrapper(),this.bindAction(),this.insertImageArray(jQuery(".galleryBuffer .galleryImageContainer")),this.hasGalleryEnded()},bindAction:function(){this.input.on("change",function(){this.filterTags()}),jQuery(window).resize(debouncer(function(){ScreenGallery.placeInRows()})),jQuery(window).scroll(debouncer(function(){ScreenGallery.hasGalleryEnded()}))},positionWrapper:function(){this.wrapper.parent().height(this.wrapper.height()+50)},width:function(){return this.wrapper.width()},insertImageArray:function(e){e.each(function(){var e=new galleryImage(jQuery(this));ScreenGallery.galleryImages.push(e)}),this.placeInRows()},hasGalleryEnded:function(){isOnScreen(jQuery(".galleryEnd"))&&(this.loadMoreImages(),debouncer(function(){$(window).scroll()},1e3))},placeInRows:function(){this.galleryRows.forEach(function(e){e.remove()}),this.galleryRows.length=0;var e=[],r=0;this.galleryImages.forEach(function(i){r+=i.targetWidth,e.push(i),r>=ScreenGallery.width()&&(ScreenGallery.galleryRows.push(new row(e,r)),e=[],r=0)}),e.length&&this.galleryRows.push(new row(e,r)),this.positionWrapper()},loadMoreImages:function(){jQuery.ajax({type:"POST",url:ajaxdata.ajaxurl,data:{action:"get_images",offset:this.offset},success:function(e){if("empty"==e)return ScreenGallery.loadMoreImages=void 0,void 0;var r=jQuery(".galleryBuffer .galleryImageContainer").length;jQuery(".galleryBuffer").append(e),ScreenGallery.insertImageArray(jQuery(".galleryBuffer .galleryImageContainer").slice(r)),ScreenGallery.offset+=10}})}};!function(){ScreenGallery.init()}();